---
import Layout from "../layouts/Layout.astro";
import Grid from '$components/Grid.svelte';
import Greeting from '$components/Greeting.svelte';
import CardList from '$components/CardList.svelte';
import Card from '$components/CardAdvert.svelte';
import SelfService from '$components/SelfService.svelte';

import video from '$assets/video/summer-4k.mp4?url';

const cards = await Astro.glob('../content/cards/*.mdx');

const greeting = {
  highlighted: 'Hello.',
  greeting: 'How can we help you?'
}

let qrCodes = [
  [ "Patient & visitor guide" ],
  [ "Online Gift shop" ],
  [ "Guest Services phone" ],
  [ "MyChart" ],
];
---

<Layout title="University Hospital" bodyClass={'summer'}>
  <main id="main">
    <div class="video-container">
      <video id="video" muted="true" autoplay="true" playsinline loop="true" preload="auto" src={video} class="video"></video>
    </div>

    <div class="skrim"><!-- Blank div for adding a gradient over the background --></div>

    <div class="content">
      <Grid class="base-grid" columns={8} gap='2rem'>

        <Greeting {...greeting} />

        <CardList class='card-list'>
          {cards.map(({ title, subhead, image, icon }) => (
            <Card subhead={subhead} image={image} icon={icon}>
              <Fragment slot="title">{title}</Fragment>
            </Card>
          ))}
        </CardList>

        <div class="self-service">
          <SelfService qrCodes={qrCodes}/>
        </div>

      </Grid>
    </div>
  </main>

  <script type="module">
    const RELOAD_TIMER = 14400000; // 4 hours

    function prepareReload() {
      document.getElementById('main').classList.add('prepare-reload');
    }

    window.onload = () => {
      const video = document.getElementById('video');
      if (video.paused) video.play();
      setTimeout(()=> { prepareReload() }, (RELOAD_TIMER - 2000));
      setTimeout(()=> { location.reload() }, RELOAD_TIMER);
    }
  </script>
</Layout>

<style>
  @keyframes fade-in { 0% { opacity: 0;}; 100% {opacity: 1;}}
  @keyframes fade-out { 0% { opacity: 1;}; 100% {opacity: 0;}}

  main {
    height: 100%;
    width: 100%;
    display: grid;
    background-size: cover;
    position: relative;
    transition: opacity .4s ease-out;
  }

  .video-container {
    left: 0;
    width: 100%;
    overflow: hidden;
    position: relative;
    aspect-ratio: var(--aspect-ratio);
    animation: fade-in 2s 0s ease-out both normal;
    transition: opacity 2s ease-in-out;
  }

  :global(.prepare-reload) .video-container {
    opacity: 0;
    animation: fade-out 2s ease-out 0s 1 normal both !important;
  }

  .video-container,
  .content {
    grid-column: 1/1;
    grid-row: 1/1;
  }

  .video {
    position: absolute;
    top: 0;
    left: 0;
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: 50% 32%;
  }

  .content {
    position: relative;
    z-index: 3;
  }

  .self-service {
    grid-column: span 3;
    position: relative;
    z-index: 2;
  }

  .base-grid {
    height: 100%;
  }

  :global(.card-list) {
    grid-column: span 3;
    position: relative;
    z-index: 3;
  }

  .skrim {
    position: absolute;
    z-index: 1;
    left: 0; top: 0; bottom: 0; right: 0;
    /* background-image: linear-gradient(210deg,rgb(34 195 255 / 0%) 65%,rgba(84, 35, 78, 0.876));
    mix-blend-mode: multiply;
    /* background-image: linear-gradient(210deg,rgba(44, 9, 126, 0.02) 55%,rgba(78, 39, 85, 0.5));
    mix-blend-mode: overlay; */
    /* background-image:
      linear-gradient(210deg, white, black),
      linear-gradient(
        210deg,
        rgba(18, 224, 176, 0.05) 25%,
        rgba(13, 80, 102, 0.2) 40%,
        rgba(79, 82, 30, 0.95) 80%,
        rgba(9, 0, 73, 0.97)
      )
    ;
    mix-blend-mode: overlay; */
    background-image: radial-gradient(
      45% 40% at 10% 46%,
      hsl(48deg 100% 24% / 50%) 0%,
      hsl(97deg 85% 30% / 15%) 40%,
      hsl(205deg 83% 45% / 0%) 80%
    );
    mix-blend-mode: multiply;
    animation: fade-in 1.25s ease-out 0s 1 normal both;
  }

  :global(.prepare-reload) .skrim {
    animation-direction: reverse;
    animation-iteration-count: 1;
    animation-play-state: running;
  }
</style>
